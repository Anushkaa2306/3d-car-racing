<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Racing Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #222;
            color: white;
            font-family: Arial, sans-serif;
        }
        #startPage, #gameOver {
            position: fixed;
            top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.9);
            display:flex; flex-direction:column; align-items:center; justify-content:center;
            z-index: 1000;
        }
        #mainContainer { display: none; }
        button {
            padding:10px 20px; font-size:18px; border:none; border-radius:8px;
            background:#ffcc00; cursor:pointer;
        }
    </style>
</head>
<body>
    <!-- Start Page -->
    <div id="startPage">
        <h1>Car Racing Game</h1>
        <button onclick="startGame()">Start Racing</button>
    </div>

    <!-- Game Container -->
    <div id="mainContainer">
        <canvas id="canvas"></canvas>
        <div id="scoreBoard" style="position:fixed; top:10px; left:10px; font-size:20px;">
            Score: <span id="score">0</span>
        </div>
    </div>

    <!-- Game Over Page -->
    <div id="gameOver" style="display:none;">
        <h1>Game Over</h1>
        <p>Your Score: <span id="finalScore">0</span></p>
        <button onclick="restartGame()">Restart</button>
    </div>

<script>
let c, ctx, w, h, carW=50, carH=80, cx, cy, cars=[], score=0, intv;
let cl=false, cr=false; // control flags

function startGame(){
    document.getElementById("startPage").style.display="none";
    document.getElementById("mainContainer").style.display="block";
    init();
}

function init(){
    c = document.getElementById("canvas");
    ctx = c.getContext("2d");
    w = window.innerWidth;
    h = window.innerHeight;
    c.width = w;
    c.height = h;
    cx = w/2 - carW/2;
    cy = h - carH - 20;
    cars = [];
    score = 0;
    document.getElementById("score").textContent = score;

    intv = setInterval(update, 30);

    // Keyboard Controls
    document.onkeydown = function(e){
        if(e.keyCode==37) cl = true;
        if(e.keyCode==39) cr = true;
    }
    document.onkeyup = function(e){
        if(e.keyCode==37) cl = false;
        if(e.keyCode==39) cr = false;
    }

    // Touch Controls (NEW)
    c.addEventListener("touchstart", handleTouch);
    c.addEventListener("touchend", handleTouchEnd);
}

function update(){
    ctx.clearRect(0,0,w,h);

    // Player Car
    ctx.fillStyle="red";
    if(cl && cx>0) cx -= 10;
    if(cr && cx < w-carW) cx += 10;
    ctx.fillRect(cx, cy, carW, carH);

    // Opponent Cars
    if(Math.random()<0.05){
        let ox = Math.random()*(w-carW);
        cars.push({x:ox, y:-carH});
    }

    ctx.fillStyle="blue";
    for(let i=0;i<cars.length;i++){
        let car = cars[i];
        car.y += 10;
        ctx.fillRect(car.x, car.y, carW, carH);

        // Collision
        if(car.y+carH>=cy && car.y<=cy+carH && car.x+carW>=cx && car.x<=cx+carW){
            gameOver();
        }

        // Score
        if(car.y>h){
            score++;
            document.getElementById("score").textContent = score;
            cars.splice(i,1); i--;
        }
    }
}

function gameOver(){
    clearInterval(intv);
    document.getElementById("mainContainer").style.display="none";
    document.getElementById("gameOver").style.display="flex";
    document.getElementById("finalScore").textContent = score;
}

function restartGame(){
    document.getElementById("gameOver").style.display="none";
    document.getElementById("startPage").style.display="flex";
}

// Touch Functions
function handleTouch(e){
    let touch = e.touches[0];
    if(touch.clientX < w/2){ // left side
        cl = true; cr = false;
    } else { // right side
        cr = true; cl = false;
    }
}
function handleTouchEnd(){
    cl = false; cr = false;
}
</script>
</body>
</html>
